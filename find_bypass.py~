from cobra.io.sbml import create_cobra_model_from_sbml_file
from cobra.flux_analysis.parsimonious import optimize_minimal_flux
from draw_flux import DrawFlux
from html_writer import HtmlWriter
from analysis_toolbox import model_summary
from cobra.core import Reaction, Metabolite, Formula

model_fname = 'ecoli_core.xml'
model = create_cobra_model_from_sbml_file(model_fname)
carbon_source = 'xu5p_D'


#ko = ['EDD', 'F6PA', 'PGM', 'PFL', 'G6PDH2r', 'ICL', 'PGL', 'PFK']
ko = ['G6PDH2r', 'PGL', 'PFK']

model.remove_reactions(ko)

Metabolite()
model.add_metabolites(['xu5p_D_e'])
rxns = dict([(r.id, r) for r in model.reactions])
rxns['EX_glc_e'].lower_bound = 0  
rxns['EX_'+carbon_source+'_e'].lower_bound = -1000 

optimize_minimal_flux(model)
print "solution: %.02f 1/h" % model.solution.f

html = HtmlWriter('res/report.html')
df = DrawFlux('EcoliMetabolism.svg')
df.ToSVG(model, model.solution, html)
model_summary(model, model.solution, html)